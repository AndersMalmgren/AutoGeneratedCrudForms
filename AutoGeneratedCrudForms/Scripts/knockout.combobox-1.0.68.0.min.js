(function(){ko.bindingHandlers.combobox={setDefaults:function(k){ko.utils.extend(b,k);},init:function(m,s,k,t,l){var p=ko.utils.unwrapObservable(s());for(var n in b){if(p[n]===undefined){p[n]=b[n];}}var r=ko.isObservable(k().comboboxValue);var q=ko.computed({read:function(){return ko.utils.unwrapObservable(k().comboboxValue);},write:function(u){j(k().comboboxValue,k,"comboboxValue",u);if(!r){q.notifySubscribers(u);}},disposeWhenNodeIsRemoved:m});var o=new ko.bindingHandlers.combobox.ViewModel(p,t,q);f(m,p.comboboxTemplate,o,l);return{controlsDescendantBindings:true};}};ko.bindingHandlers.flexibleTemplate={engines:{},init:function(m,o,k,p,l){var n=ko.utils.unwrapObservable(o());f(m,n.template,n.data,l);return{controlsDescendantBindings:true};}};ko.bindingHandlers.clickedIn={init:function(n,p,k,q,l){var o=p();var m=false;ko.utils.registerEventHandler(document,"click",function(r){if(!m){o(r.target==n);}m=false;});ko.utils.registerEventHandler(n.parentNode||n.parentElement,"click",function(r){m=true;});}};ko.bindingHandlers.keys={init:function(m,o,k,p,l){var n=o();ko.utils.registerEventHandler(m,"keydown",function(q){n(q.keyCode);});}};ko.bindingHandlers.combobox.ViewModel=function(k,m,l){this.options=k;this.keyPress=ko.observable().extend({notify:"always"});this.keyPress.subscribe(this.onKeyPress,this);this.searchText=ko.observable("");this.searchText.subscribe(this.onSearch,this);this.placeholder=k.placeholder;this.viewModel=m;this.dataSource=this.options.dataSource;this.functionDataSource=!ko.isObservable(this.dataSource)&&typeof this.dataSource=="function"?this.dataSource:this.searchOnClientSide.bind(this);this.selectedObservable=l;this.selectedObservable.subscribe(this.setSelectedText,this);if(l()!=null){this.setSelectedText(l());}this.dropdownVisible=ko.observable(false);this.dropdownItems=k.dropdownItemsArray||ko.observableArray();this.searchHasFocus=ko.observable();this.paging=new ko.bindingHandlers.combobox.PagingViewModel(k,this.getData.bind(this),this.dropdownItems,this.forceFocus.bind(this));this.currentActiveIndex=0;this.rowTemplate=k.rowTemplate.replace("$$valueMember&&",k.valueMember);};ko.bindingHandlers.combobox.ViewModel.prototype={onKeyPress:function(k){switch(k){case 27:this.hideDropdown();break;case 13:if(this.dropdownVisible()){this.selected(this.getCurrentActiveItem());}else{this.forceShow();}break;case 38:this.navigate(-1);break;case 40:this.navigate(1);break;}},onSearch:function(k){if(this.explicitSet||k.length<this.options.minimumSearchTextLength){return;}this.resetDropdown();clearTimeout(this.searchTimeout);this.searchTimeout=setTimeout(this.getData.bind(this),this.options.keyPressSearchTimeout);},getData:function(m){var o=this.searchText();var k=function(p){if(this.searchText()==o){this.getDataCallback(p);}}.bind(this);var l={text:o,page:m?m:0,pageSize:this.options.pageSize,total:this.paging.totalCount(),callback:k};var n=this.functionDataSource.call(this.viewModel,l);if(n){l.callback=e;if(d(n)){n.then(k);}else{k(n);}}},getDataCallback:function(l){var k=[];ko.utils.arrayForEach(l.data,function(m){k.push(new ko.bindingHandlers.combobox.ItemViewModel(m));}.bind(this));this.dropdownItems(k);this.paging.totalCount(l.total);this.dropdownVisible(true);this.navigate(0);},forceFocus:function(){this.searchHasFocus(true);},resetDropdown:function(){this.currentActiveIndex=0;this.paging.reset();},selected:function(k){this.forceFocus();this.selectedObservable(k.item);this.hideDropdown();},setSelectedText:function(k){this.explicitSet=true;this.searchText(this.getLabel(k));this.explicitSet=false;},hideDropdown:function(){this.dropdownVisible(false);},showDropdown:function(){this.dropdownVisible(true);},forceShow:function(){this.forceFocus();if(this.paging.itemCount()==0){this.getData();}else{this.showDropdown();}},navigate:function(k){if(this.dropdownItems().length>0&&this.dropdownVisible()){this.unnavigated(this.getCurrentActiveItem());this.currentActiveIndex+=k;this.currentActiveIndex=this.currentActiveIndex<0?0:this.currentActiveIndex;this.currentActiveIndex=this.currentActiveIndex>=this.paging.itemCount()?this.paging.itemCount()-1:this.currentActiveIndex;this.navigated(this.getCurrentActiveItem());}},getCurrentActiveItem:function(){return this.dropdownItems()[this.currentActiveIndex];},navigated:function(k){k.navigated(true);},unnavigated:function(k){k.navigated(false);},active:function(k){k.active(true);},inactive:function(k){k.active(false);},getLabel:function(k){return ko.utils.unwrapObservable(k?k[this.options.valueMember]:null);},searchOnClientSide:function(m){var l=(m.text||"").toLowerCase();var n=this;var k=ko.utils.arrayFilter(ko.utils.unwrapObservable(this.dataSource),function(o){return n.getLabel(o).toLowerCase().slice(0,l.length)==l;});return{total:k.length,data:k.splice(m.pageSize*m.page,m.pageSize)};}};ko.bindingHandlers.combobox.ItemViewModel=function(k){this.item=k;this.navigated=ko.observable();this.active=ko.observable();};ko.bindingHandlers.combobox.PagingViewModel=function(n,k,l,m){this.options=n;this.currentPage=ko.observable(0);this.totalCount=ko.observable();this.totalCount.subscribe(this.update,this);this.itemCount=ko.computed(function(){return l().length;},this);this.currentFloor=ko.computed(function(){return this.itemCount()===0?0:(this.currentPage()*n.pageSize)+1;},this);this.currentRoof=ko.computed(function(){return(this.currentPage()*n.pageSize)+this.itemCount();},this);this.pages=ko.observableArray();this.show=ko.computed(function(){return this.options.paging&&this.totalCount()>this.options.pageSize;},this);this.callback=k;this.forceFocus=m;};ko.bindingHandlers.combobox.PagingViewModel.prototype={update:function(k){var l=this.currentPage();var q=[];var r=Math.ceil(k/this.options.pageSize);var o=Math.min(this.options.pagingLinks,r);var p=l-(o/2);var n=l+(o/2);if(p<0){n+=Math.abs(p);p=0;}if(n>r){p=p-(n-r);n=r;}for(var m=p;m<n;m++){q.push(this.createPage(m));}this.pages(q);},createPage:function(k){return{name:k+1,index:k,isCurrent:ko.computed(function(){return k==this.currentPage();},this)};},pageSelected:function(k){this.forceFocus();this.currentPage(k.index);this.callback(k.index);this.update(this.totalCount());},reset:function(){this.currentPage(0);}};var e=function(){};var c=function(k){return k===Object(k);};var d=function(k){return c(k)&&typeof k.then==="function";};var j=function(n,k,m,p,l){if(!n||!ko.isObservable(n)){var o=k()["_ko_property_writers"];if(o&&o[m]){o[m](p);}}else{if(ko.isWriteableObservable(n)&&(!l||n.peek()!==p)){n(p);}}};var f=function(m,r,l,k){var o=ko.bindingHandlers.flexibleTemplate.engines;var n=o[r];var q=false;do{try{ko.renderTemplate(r,k.createChildContext(l),n,m,"replaceChildren");q=true;o[r]=n;}catch(p){if(n!=null){throw"Template engine not found";}n={templateEngine:h};}}while(!q);};var i=function(k){this.template=k;};i.prototype.text=function(){return this.template;};var h=new ko.nativeTemplateEngine();h.makeTemplateSource=function(k){return new i(k);};var a='<div data-bind="keys: keyPress">        <input data-bind="value: searchText, valueUpdate: \'afterkeydown\', hasfocus: searchHasFocus, attr: { placeholder: placeholder }"></input><button class="btn btn-arrow" data-bind="click: forceShow, css: { open: dropdownVisible }"><span class="caret"></span></button>        <div class="dropdown-menu" data-bind="visible: dropdownVisible, clickedIn: dropdownVisible">            <!-- ko foreach: dropdownItems -->                <div data-bind="click: $parent.selected.bind($parent), event: { mouseover: $parent.active.bind($parent), mouseout: $parent.inactive.bind($parent) }, css: { active: navigated, highlighted: active },  flexibleTemplate: { template: $parent.rowTemplate, data: $data.item }"></div>            <!-- /ko -->            <div class="nav" data-bind="with: paging">                <p class="counter">Showing <span data-bind="text: currentFloor"></span>-<span data-bind="text: currentRoof"></span> of <span data-bind="text: totalCount"></span></p>                <div class="pagination"><ul data-bind="visible: show, foreach: pages"><li data-bind="click: $parent.pageSelected.bind($parent), text: name, disable: isCurrent, css: {current: isCurrent}"></li></ul></div>            </div>        </div>    </div>';var g='<span data-bind="text: $$valueMember&&"></span>';var b={comboboxTemplate:a,rowTemplate:g,valueMember:"name",pageSize:10,paging:true,pagingLinks:4,keyPressSearchTimeout:200,minimumSearchTextLength:1};}());